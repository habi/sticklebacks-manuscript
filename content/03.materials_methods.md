## Materials & Methods {.page_break_before}

### Sample preparation

### microtomographic imaging

- Scanned on a [Bruker SkyScan 2214](https://www.bruker.com/en/products-and-solutions/diffractometers-and-x-ray-microscopes/3d-x-ray-microscopes/skyscan-2214.html)
- Sample holder generated with [OpenSCAD](https://openscad.org/), available online at [GitHub](https://github.com/TomoGraphics/Hol3Drs/blob/master/STL/Stickleback.Multiple.stl) [@doi:10.5281/zenodo.2587555]
  - Scanning several fish toghether to efficiently use machine time
  - Full in Bruker workflow
  - Results in PNG stacks on disk

### Data analysis

- [Jupyter notebooks](https://github.com/habi/sticklebacks) [@doi:10.5281/zenodo.18257528]
  - Efficiently loading data from disk with [`dask`](https://www.dask.org/) [@dask]
  - Extract position of single fish (all scanned together), based on the MIP of the scan (see Figure @fig:labels).
  - Crop out each fish (with a buffer) and write to cropped dataset (see Figure @fig:cropping).
    - Cropped datasets are saved to discrete folders for easy handling.
      In both original gray-scale plus as thresholded dataset, e.g. binarized into bone and "not bone".
      These are saved out as [`zarr`](https://zarr.dev/) [@wikidata:Q130377195] and [`nrrd`](https://teem.sourceforge.net/nrrd/) files.
      
![Maximum intensity projections of one acquired dataset along all three cardinal axes.](images/Sticklebucket_H.rec.MIPs.png){#fig:mips}

![Automatically detected regions based on maximum intensity projection along the rotation axis of the tomographic scan. The regions are numbered consecutively from the top left to the bottom right. These numbers are mapped to the correct fish ID in the next step.](images/Sticklebucket_H.rec.Labels.Detected.png){#fig:labels}

![Mapping lab book notes, photos and detected regions to fish ID.](images/Sticklebucket_H.rec.Labels.Check.png){#fig:checking}

![Doublechecking crop extent and fish ID.](images/Sticklebucket_H.rec.Regions.Check.png){#fig:cropping}